/*! lineup-v1 - v0.1.5 - 2016-11-08
* https://github.com/stopyoukid/lineup.js
* Copyright (c) 2016 ; Licensed BSD */
(function(){function a(a,b,c){var d;!function(a,b,c,d){function e(d,e,f){var g,h;return this.storage=d.storage,this.spec=d,this.$container=e,this.tooltip=a.createTooltip(e.node()),this.tooltip.hide(),this.listeners=b.dispatch("hover","change-sortcriteria","change-filter","columns-changed","selected","multiselected","generate-histogram"),this.config=c.extend(!0,{},a.defaultConfig,f,{columnBundles:{primary:{sortedColumn:null,sortingOrderAsc:!0,prevRowScale:null}}}),this.storage.config=this.config,this.config.svgLayout.addPlusSigns||(this.config.svgLayout.plusSigns={}),"combined"===this.config.svgLayout.mode?(e.classed("lu-mode-combined",!0),this.$table=e.append("svg").attr("class","lu"),g=this.$table.append("defs"),g.append("defs").attr("class","columnheader"),g.append("defs").attr("class","column"),g.append("defs").attr("class","overlay"),this.$body=this.$table.append("g").attr("class","body").attr("transform","translate(0,"+this.config.htmlLayout.headerHeight+")"),this.$header=this.$table.append("g").attr("class","header"),this.$bodySVG=this.$headerContainer=this.$table,h=this.initScrolling(c(e.node()),this.config.htmlLayout.headerHeight)):(e.classed("lu-mode-separate",!0),this.$table=e,this.$headerContainer=this.$table.append("div").attr("class","lu lu-header"),this.$headerContainer.style({height:this.config.htmlLayout.headerHeight+"px",width:"100%"}),this.$header=this.$headerContainer.append("div"),this.$bodySVG=this.$table.append("div").attr("class","lu-wrapper").append("div").attr("class","lu lu-body").attr("height","100%").attr("style","overflow-y:auto;height:100%"),this.$spacer=this.$bodySVG.append("div"),this.$body=this.$bodySVG,h=this.initScrolling(c(e.node()).find("div.lu-wrapper"),0)),this.selectVisible=h.selectVisible,this.onScroll=h.onScroll,this.$header.append("div").attr("class","header-background").style({width:"100%",height:this.config.htmlLayout.headerHeight+"px","background-color":"lightgray"}).text(" "),this.$header.append("div").attr("class","main").style({width:"100%",height:this.config.htmlLayout.headerHeight+"px"}).text(" "),this.$header.append("div").attr("class","overlay"),this.headerUpdateRequired=!0,this.stackedColumnModified=null,this.dragWeight=this.initDragging(),this}a.prototype=e.prototype=c.extend(e.prototype,a.prototype),a.create=function(a,b,c){"storage"in a||(a={storage:a});var d=new e(a,b,c);return d.startVis(),d},a.prototype.scrolled=function(a,b){"combined"===this.config.svgLayout.mode?(this.$header.style({transform:"translate(0px,"+a+"px)"}),this.$header.selectAll("div.header-background").style({transform:"translate(0px,"+-a+"px)"})):(this.$header.style({transform:"translate("+-b+"px,0px)"}),this.$header.selectAll("div.header-background").style({transform:"translate("+b+"px,0px)"}))},a.defaultConfig={colorMapping:b.map(),columnColors:b.scale.category20(),grayColor:"#999999",numberformat:b.format(".3n"),cellFormatter:d,htmlLayout:{headerHeight:50,headerOffset:0,buttonTopPadding:3,labelLeftPadding:12,buttonRightPadding:18,buttonWidth:13,handleWidth:4},renderingOptions:{stacked:!1,values:!1,animation:!0,histograms:!1},svgLayout:{mode:"combined",rowHeight:20,rowPadding:2,columnPadding:2,rowBarPadding:0,backupScrollRows:10,animationDuration:1e3,addPlusSigns:!1,plusSigns:{addStackedColumn:{title:"Add stacked column",action:"addNewEmptyStackedColumn",x:0,y:2,w:21,h:21}},rowActions:[]},manipulative:!0,interaction:{tooltips:!0,multiselect:function(){return!1},rangeselect:function(){return!1}},filter:{skip:0,limit:Number.POSITIVE_INFINITY,filter:d}},a.prototype.on=function(a,b){return arguments.length<2?this.listeners.on(a):(this.listeners.on(a,b),this)},a.prototype.changeDataStorage=function(a){this.storage=a.storage,this.storage.config=this.config,this.spec=a,this.config.columnBundles.primary.sortedColumn=null,this.headerUpdateRequired=!0,delete this.prevRowScale,this.startVis()},a.prototype.changeInteractionOption=function(a,b){var c=this.config.interaction[a];c!==b&&(this.config.interaction[a]=b)},a.prototype.changeRenderingOption=function(a,b){var c=this.config.renderingOptions[a];c!==b&&(this.config.renderingOptions[a]=b,"histograms"===a&&b&&this.storage.resortData({filteredChanged:!0}),this.updateAll(!0))},a.prototype.startVis=function(){this.assignColors(this.storage.getRawColumns()),this.headerUpdateRequired=!0,this.storage.resortData({}),this.updateAll()},a.prototype.assignColors=function(c){var d=this.config;d.colorMapping=b.map();var e=0;c.forEach(function(b){b.color?d.colorMapping.set(b.id,b.color):b instanceof a.LineUpStringColumn||"rank"===b.id?d.colorMapping.set(b.id,d.grayColor):(d.colorMapping.set(b.id,d.columnColors(e)),e++)})},a.prototype.updateAll=function(a,b){function c(b){var c=d.storage.getColumnLayout(b);d.updateHeader(c),d.updateBody(c,d.storage.getData(b),a||!1)}var d=this;b?c(b):Object.keys(this.storage.bundles).forEach(c)},a.prototype.sortBy=function(a,b){a=a||this.storage.primaryKey,b=b||!1;var c=this.storage.getColumnByName(a);if(!c)return!1;var d=this.config.columnBundles[c.columnBundle];d.sortingOrderAsc=b,d.sortedColumn=c,this.listeners["change-sortcriteria"](this,c,d.sortingOrderAsc),this.config.sorting&&this.config.sorting.external||this.storage.resortData({column:c,asc:d.sortingOrderAsc}),this.updateAll(!1,c.columnBundle)},a.prototype.toggleStackedRendering=function(){this.config.renderingOptions.stacked=!this.config.renderingOptions.stacked,this.updateAll(!0)},a.prototype.toggleValueRendering=function(){this.config.renderingOptions.values=!this.config.renderingOptions.values,this.updateAll(!0)},a.prototype.setLimits=function(a,b){this.config.filter.skip=a,this.config.filter.limit=b,this.storage.resortData({}),this.updateAll()},a.prototype.changeWeights=function(b,c){"string"==typeof b&&(b=this.storage.getColumnByName(b)),b=b||this.config.columnBundles.primary.sortedColumn;var d=b.columnBundle;return b instanceof a.LayoutStackedColumn?(b.updateWeights(c),b===this.config.columnBundles[d].sortedColumn&&(this.listeners["change-sortcriteria"](this,b,this.config.columnBundles[d]),this.config.sorting&&this.config.sorting.external||this.storage.resortData({key:d})),this.updateAll(!1,d),!0):!1},a.prototype.changeFilter=function(a,b){"string"==typeof a&&(a=this.storage.getColumnByName(a)),a.filter=b,this.listeners["change-filter"](this,a),this.config.filtering&&this.config.filtering.external||this.storage.resortData({filteredChanged:!0}),this.updateBody()},a.prototype.destroy=function(){this.tooltip.destroy(),this.$container.selectAll("*").remove(),"combined"===this.config.svgLayout.mode&&this.$container.off("scroll",this.onScroll)}}(d||(d={}),b,a);var d;!function(a,b,c,d,e){function f(a){return a.replace(/[\s!\'#$%&'\(\)\*\+,\.\/:;<=>\?\@\[\\\]\^`\{\|\}~]/g,"_")}function g(a){this.column=a.column,this.label=a.label||a.column,this.color=a.color,this.id=f(a.id||this.column),this.missingValue=a.missingValue,this.layout={}}function h(a){return"number"!=typeof a||isNaN(a)}function i(a,c,d){g.call(this,a),this.domain=a.domain||[NaN,NaN],this.range=a.range||[0,1],"undefined"==typeof this.missingValue&&(this.missingValue=NaN);var e=this;if(h(this.domain[0])||h(this.domain[1])){var f=b.extent(d,function(a){return e.getValue(a)});h(this.domain[0])&&(this.domain[0]=f[0]),h(this.domain[1])&&(this.domain[1]=f[1])}}function j(a){g.call(this,a)}function k(a,c,d){g.call(this,a),this.categories=[],this.categoryColors=b.scale.category10().range();var e=this;a.categories&&a.categories.forEach(function(a,b){"string"==typeof a?e.categories.push(a):(e.categories.push(a.name),e.categoryColors[b]=a.color)}),0===this.categories.length&&(this.categories=b.set(d.map(function(a){return e.getValue(a)})).values(),this.categories.sort())}function l(a){var b=this;this.columnWidth=a.width||100,this.id=d.uniqueId("Column_"),this.filter=a.filter,this.parent=a.parent||null,this.columnBundle="primary",this.sortBy=function(a,c){return a=b.getValue(a),c=b.getValue(c),b.safeSortBy(a,c)}}function m(a,b){l.call(this,a),this.columnLink=a.column,this.column=b.get(a.column),this.id=f(d.uniqueId(this.columnLink+"_"))}function n(a,c){m.call(this,a,c),this.value2pixel=b.scale.linear().domain([0,1]).range([0,this.columnWidth]);var d=a.domain||this.column.domain;h(d[0])&&(d[0]=this.column.domain[0]),h(d[1])&&(d[1]=this.column.domain[1]),this.scale=b.scale.linear().clamp(!0).domain(d).range(a.range||this.column.range),this.histgenerator=b.layout.histogram();var e=this;this.histgenerator.range(this.scale.range()),this.histgenerator.value(function(a){return e.getValue(a)}),this._hist=[]}function o(a,b){m.call(this,a,b)}function p(a,b){m.call(this,a,b)}function q(a,b){m.call(this,a,b)}function r(a,c,e,g){l.call(this,a?a:{},[]),this.columnWidth=a?a.width||50:50,this.id=f(d.uniqueId("rank_")),this.values=b.map(),this.storage=g}function s(a,b){l.call(this,a,b),this.childrenLinks=a.children||[],this.label=a.label||this.id}function t(a,c,d){s.call(this,a,c),this.childrenWeights=[],this.childrenWidths=[],this.toLayoutColumn=d,this.children=[],this.emptyColumns=[],this.scale=b.scale.linear().domain([0,1]).range([0,this.columnWidth]),this.init(a);var e=this;this.sortBy=function(a,b){var c=0,d=0;return e.children.forEach(function(e){c+=e.getWidth(a),d+=e.getWidth(b)}),e.safeSortBy(c,d)}}function u(a){l.call(this,a,[]),this.id=d.uniqueId("empty_"),this.label="{empty}",this.columnWidth=50}function v(a){a=a||{},l.call(this,a,[]),this.id=d.uniqueId("action_"),this.label="",this.columnWidth=a.width||50}a.LineUpColumn=g,g.prototype=c.extend({},{},{getValue:function(a){var b=a[this.column];return"undefined"==typeof b?this.missingValue:b},getRawValue:function(a){var b=this.getValue(a);return"undefined"==typeof b?"":b}}),a.LineUpNumberColumn=i,i.prototype=c.extend({},g.prototype,{getValue:function(a){var b=g.prototype.getValue.call(this,a);return(null===b||"undefined"==typeof b||""===b||0===b.toString().trim().length)&&(b=this.missingValue),+b},getRawValue:function(a){var b=g.prototype.getValue.call(this,a);return isNaN(b)?"":b}}),a.LineUpStringColumn=j,j.prototype=c.extend({},g.prototype,{}),a.LineUpCategoricalColumn=k,k.prototype=c.extend({},g.prototype,{}),a.LayoutColumn=l,l.prototype=c.extend({},{},{setColumnWidth:function(a,b){this.columnWidth=a,!b&&this.parent&&this.parent.updateWidthFromChild({id:this.id,newWidth:a})},getColumnWidth:function(){return this.columnWidth},prepare:function(){},safeSortBy:function(a,c){var d="number"==typeof a&&isNaN(a),e="number"==typeof c&&isNaN(c);return d&&e?0:d?1:e?-1:b.descending(a,c)},flattenMe:function(a){a.push(this)},description:function(){var a={};return a.width=this.columnWidth,a.filter=this.filter,a},makeCopy:function(){return new l(this.description())},isFiltered:function(){if(this instanceof n){var a=this.originalMapping(),b=this.scale;if(a&&b){var c=a.domain(),d=b.domain();return!(isNaN(d[0])||isNaN(d[1])||d[0]===c[0]&&d[1]===c[1])}return!1}return"undefined"!=typeof this.filter&&""!==this.filter&&null!==this.filter},filterBy:function(){return!0}}),a.LayoutSingleColumn=m,m.prototype=c.extend({},l.prototype,{getValue:function(a,b){return"raw"===b?this.column.getRawValue(a):this.column.getValue(a)},getLabel:function(){return this.column.label},getDataID:function(){return this.column.id},description:function(){var a=l.prototype.description.call(this);return a.column=this.columnLink,a},makeCopy:function(){var a=this.description(),c=b.map();c.set(this.columnLink,this.column);var d=new m(a,c);return d}}),a.LayoutNumberColumn=n,n.prototype=c.extend({},m.prototype,{mapping:function(a){return arguments.length<1?this.scale:(this.scale=a.clamp(!0),void this.histgenerator.range(a.range()))},originalMapping:function(){return b.scale.linear().clamp(!0).domain(this.column.domain).range(this.column.range)},getHist:function(a){var b=this;this.histogramGetter?this.histogramGetter(this,function(c){a.call(b,c)}):setTimeout(function(){a.call(b,b._hist)},0)},prepare:function(a,c,d){if(this.histogramGetter=d,!c||d)return void(this._hist=[]);this._hist=this.histgenerator(a).map(function(a){return{x:a.x,dx:a.dx,y:a.y}});var e=b.max(this._hist,function(a){return a.y});this._hist.forEach(function(a){e>0?a.y/=e:a.y=0})},binOf:function(a,b){var c=this;this.getHist(function(d){var e,f=c.getValue(a);if(d)for(e=d.length-1;e>=0;--e){var g=d[e];if(g.x<=f&&f<=g.x+g.dx)return void b.call(c,e)}b.call(c,-1)})},setColumnWidth:function(a,b){this.value2pixel.range([0,a]),m.prototype.setColumnWidth.call(this,a,b)},getValue:function(a,b){return"raw"===b?this.column.getRawValue(a):this.scale(this.column.getValue(a))},getWidth:function(a){var b=this.getValue(a);if(isNaN(b)||"undefined"==typeof b)return 0;var c=this.scale.domain();return c[0]===c[1]?this.value2pixel.range()[1]:this.value2pixel(b)},filterBy:function(a){var b=this.filter;if("undefined"==typeof b||!this.column)return!0;var c=this.getValue(a,"raw");return"number"==typeof b&&isNaN(b)?!isNaN(c):"number"==typeof b?c>=b:Array.isArray(b)?b[0]<=c&&c<=b[1]:!0},description:function(){var a=l.prototype.description.call(this);a.column=this.columnLink,a.type="number";var b=this.scale.domain(),c=this.column.domain;return(b[0]!==c[0]||b[1]!==c[1])&&(a.domain=b),b=this.scale.range(),c=this.column.range,(b[0]!==c[0]||b[1]!==c[1])&&(a.range=b),a},makeCopy:function(){var a=b.map();a.set(this.columnLink,this.column);var c=new n(this.description(),a);return c}}),a.LayoutStringColumn=o,o.prototype=c.extend({},m.prototype,{filterBy:function(a){var b=this.filter;if("undefined"==typeof b||!this.column)return!0;var c=this.getValue(a);return"boolean"==typeof c?c&&c.trim().length>0:"string"==typeof b&&b.length>0?c&&c.toLowerCase().indexOf(b.toLowerCase())>=0:b instanceof RegExp?c&&c.match(b):!0},makeCopy:function(){var a=b.map();a.set(this.columnLink,this.column);var c=new o(this.description(),a);return c}}),a.LayoutCategoricalColumn=p,p.prototype=c.extend({},m.prototype,{filterBy:function(a){var b=this.filter;if("undefined"==typeof b||!this.column)return!0;var c=this.getValue(a);return Array.isArray(b)&&b.length>0?b.indexOf(c)>=0:"string"==typeof b&&b.length>0?c&&c.toLowerCase().indexOf(b.toLowerCase())>=0:b instanceof RegExp?c&&c.match(b):!0},makeCopy:function(){var a=b.map();a.set(this.columnLink,this.column);var c=new p(this.description(),a);return c}}),a.LayoutCategoricalColorColumn=q,q.prototype=c.extend({},m.prototype,{getColor:function(a){var b=this.getValue(a,"raw");if(null===b||""===b)return null;var c=this.column.categories.indexOf(b);return 0>c?null:this.column.categoryColors[c]},filterBy:function(a){return p.prototype.filterBy.call(this,a)},makeCopy:function(){var a=b.map();a.set(this.columnLink,this.column);var c=new q(this.description(),a);return c}}),a.LayoutRankColumn=r,r.prototype=c.extend({},l.prototype,{setValue:function(a,b){this.values.set(a[this.storage.primaryKey],b)},getValue:function(a){return this.values.get(a[this.storage.primaryKey])},filter:function(a){var b=this.getValue(a);return"undefined"==typeof b?!0:"number"==typeof this.filter?b>=this.filter:Array.isArray(this.filter)?this.filter[0]<=b&&b<=this.filter[1]:!0},getLabel:function(){return"Rank"},getDataID:function(){return this.id},description:function(){var a=l.prototype.description.call(this);return a.type="rank",a},makeCopy:function(){var a=this.description(),b=new r(a,null,null,this.column.storage);return b}}),a.LayoutCompositeColumn=s,s.prototype=c.extend({},l.prototype,{getDataID:function(){return this.id},getLabel:function(){return this.label}}),a.LayoutStackedColumn=t,t.prototype=c.extend({},s.prototype,{getValue:function(a){var b=this,c=0;return this.children.forEach(function(d,e){var f=d.getValue(a);(isNaN(f)||"undefined"==typeof f)&&(f=0),c+=f*b.childrenWeights[e]}),c},init:function(a){var c=this;this.childrenLinks.length<1?this.emptyColumns.push(new u({parent:c})):(this.childrenLinks[0].hasOwnProperty("weight")?(this.childrenWeights=this.childrenLinks.map(function(a){return+(a.weight||1)}),this.scale.domain([0,b.sum(this.childrenWeights)]),a.hasOwnProperty("width")?this.childrenWidths=this.childrenWeights.map(function(a){return c.scale(a)}):(this.columnWidth=100*this.children.length,this.scale.range([0,c.columnWidth]))):(this.childrenWidths=this.childrenLinks.map(function(a){return+(a.width||100)}),this.childrenWeights=this.childrenWidths.map(function(a){return a/100}),this.columnWidth=b.sum(this.childrenWidths),this.scale.domain([0,b.sum(this.childrenWeights)]).range([0,this.columnWidth])),this.children=this.childrenLinks.map(function(a,b){return a.width=c.childrenWidths[b],a.parent=c,c.toLayoutColumn(a)}))},flattenMe:function(a,b){var c=!1;b&&(c=b.addEmptyColumns||!1),a.push(this),this.children.forEach(function(b){b.flattenMe(a)}),c&&this.emptyColumns.forEach(function(b){return b.flattenMe(a)})},filterBy:function(a){if("undefined"==typeof this.filter)return!0;var b=this.getValue(a);return"number"==typeof this.filter?b<=this.filter:Array.isArray(this.filter)?this.filter[0]<=b&&b<=this.filter[1]:!0},updateWidthFromChild:function(){var a=this;this.childrenWidths=this.children.map(function(a){return a.getColumnWidth()}),this.childrenWeights=this.childrenWidths.map(function(b){return a.scale.invert(b)}),this.columnWidth=b.sum(this.childrenWidths),this.scale.range([0,this.columnWidth]),this.scale.domain([0,b.sum(this.childrenWeights)])},setColumnWidth:function(a){var b=this;this.columnWidth=a,b.scale.range([0,this.columnWidth]),this.childrenWidths=this.childrenWeights.map(function(a){return b.scale(a)}),this.children.forEach(function(a,c){return a.setColumnWidth(b.childrenWidths[c],!0)})},updateWeights:function(a){this.childrenWeights=a,this.scale.domain([0,b.sum(this.childrenWeights)]);var c=this;this.childrenWidths=this.childrenWeights.map(function(a){return c.scale(a)}),this.columnWidth=b.sum(this.childrenWidths),this.children.forEach(function(a,b){return a.setColumnWidth(c.childrenWidths[b],!0)})},removeChild:function(c){var d=this.children.indexOf(c),e=this;this.childrenWeights.splice(d,1),this.childrenWidths.splice(d,1),this.columnWidth=b.sum(this.childrenWidths),this.scale.range([0,this.columnWidth]),this.scale.domain([0,b.sum(this.childrenWeights)]),this.children.splice(d,1),c.parent=null,this.children.length<1&&(this.emptyColumns=[new a.LayoutEmptyColumn({parent:e})],this.columnWidth=100)},addChild:function(c,d,e){if(!(c instanceof a.LayoutNumberColumn))return!1;var f=0;return d instanceof a.LayoutEmptyColumn?this.emptyColumns=[]:(f=this.children.indexOf(d),"r"===e&&f++),this.childrenWeights.splice(f,0,this.scale.invert(c.getColumnWidth())),this.childrenWidths.splice(f,0,c.getColumnWidth()),this.columnWidth=b.sum(this.childrenWidths),this.scale.range([0,this.columnWidth]),this.scale.domain([0,b.sum(this.childrenWeights)]),c.parent=this,this.children.splice(f,0,c),!0},description:function(){var a=l.prototype.description.call(this);a.type="stacked";var b=this;return a.children=this.children.map(function(a,c){var d=a.description();return d.weight=b.childrenWeights[c],d}),a.label=this.label,a},makeCopy:function(){var a=this,c=a.description();c.childrenLinks=[];var d=new t(c,{},a.toLayoutColumn);return d.children=a.children.map(function(a){return a.makeCopy()}),d.children.forEach(function(a){a.parent=d}),d.childrenWeights=this.childrenWeights.slice(0),d.scale.domain([0,b.sum(this.childrenWeights)]),d.childrenWidths=this.childrenWeights.map(function(b){return a.scale(b)}),d}}),a.LayoutEmptyColumn=u,u.prototype=c.extend({},l.prototype,{getLabel:function(){return this.label},getDataID:function(){return this.id},getValue:function(){return""}}),a.LayoutActionColumn=v,v.prototype=c.extend({},l.prototype,{getLabel:function(){return this.label},getDataID:function(){return this.id},description:function(){var a=l.prototype.description.call(this);return a.type="actions",a},getValue:function(){return""}})}(d||(d={}),b,a,c);var d;!function(a,b,c,d){function e(a,b,d,e){var f=400;e=c.extend({},e,{x:+a.node().clientWidth/2-f/2,y:0,width:f});var g=a.append("div").attr("class","lu-popupBG"),h=a.append("div").attr({"class":"lu-popup"}).style({left:e.x+"px",top:e.y+"px",width:e.width+"px"}).html('<span style="font-weight: bold">'+b+"</span>"+(d?'<input type="text" id="popupInputText" size="35" value="'+d+'"><br>':"")+'<div class="selectionTable"></div><button class="cancel"><i class="fa fa-times"></i> cancel</button><button class="ok"><i class="fa fa-check"></i> ok</button>'),i=h.select(".selectionTable").append("table");return h.select(".cancel").on("click",function(){g.remove(),h.remove()}),{popup:h,table:i,remove:function(){h.remove(),g.remove()},onOK:function(a){return h.select(".ok").on("click",a)}}}a.prototype=a.prototype||{},a.prototype.addNewStackedColumnDialog=function(){function b(){var a=g.table.selectAll("tr").data(h);a.select(".checkmark").html(function(a){return a.isChecked?'<i class="fa fa-check-square-o"></i>':'<i class="fa fa-square-o"></i>'}).on("click",function(a){a.isChecked=!a.isChecked,b()}),a.select(".datalabel").style("opacity",function(a){return a.isChecked?"1.0":".8"}),a.select(".weightInput").attr("disabled",function(a){return a.isChecked?null:!0})}function d(a){return c(f.$container.node()).find("#"+a)[0]}var f=this,g=e(this.$container,"Add stacked column:","Stacked"),h=f.storage.getRawColumns().filter(function(b){return b instanceof a.LineUpNumberColumn}).map(function(a){return{d:a,isChecked:!1,weight:1}}),i=g.table.selectAll("tr").data(h);i.enter().append("tr"),i.append("td").attr("class","checkmark"),i.append("td").attr("class","datalabel").style("opacity",.8).text(function(a){return a.d.label}),i.append("td").append("input").attr({"class":"weightInput",type:"text",value:function(a){return a.weight},disabled:!0,size:5,maxlength:5}).on("input",function(a){a.weight=+this.value,b()}),b(),g.onOK(function(){var a=d("popupInputText").value;if(a.length<1)return void window.alert("name must not be empty");var b=h.filter(function(a){return a.isChecked}),c={label:a,width:Math.max(100*b.length,100),children:b.map(function(a){return{column:a.d.column,type:"number",weight:a.weight}})};f.storage.addStackedColumn(c),g.remove(),f.headerUpdateRequired=!0,f.listeners["columns-changed"](f),f.updateAll()})},a.prototype.addNewSingleColumnDialog=function(){function a(){var b=c.table.selectAll("tr").data(f);b.select(".checkmark").html(function(a){return'<i class="fa fa-'+(a.isChecked?"check-":"")+'square-o"></i>'}).on("click",function(b){b.isChecked=!b.isChecked,a()}),b.select(".datalabel").style("opacity",function(a){return a.isChecked?"1.0":".8"})}var b=this,c=e(this.$container,"add single columns",d),f=b.storage.getRawColumns().map(function(a){return{d:a,isChecked:!1,weight:1}}),g=c.table.selectAll("tr").data(f);g.enter().append("tr"),g.append("td").attr("class","checkmark"),g.append("td").attr("class","datalabel").style("opacity",.8).text(function(a){return a.d.label}),a(),c.onOK(function(){var a=f.filter(function(a){return a.isChecked});a.forEach(function(a){b.storage.addSingleColumn({column:a.d.column})}),c.remove(),a.length&&b.listeners["columns-changed"](b),b.headerUpdateRequired=!0,b.updateAll()})},a.prototype.reweightStackedColumnWidget=function(a,c){function d(){var d=c.selectAll("tr").data(a);f.domain([0,b.max(a,e)]),d.select(".predictBar").transition().style({width:function(a){return f(a.weight)+"px"}})}var e=function(a){return a.weight},f=b.scale.linear().domain([0,b.max(a,e)]).range([0,120]),g=c.selectAll("tr").data(a),h=this.config;g.enter().append("tr"),g.append("td").style({width:"20px"}).append("input").attr({"class":"weightInput",type:"text",value:function(a){return a.weight},size:5,maxlength:5}).on("input",function(b){a[b.index].weight=+this.value,d()}),g.append("td").append("div").attr("class","predictBar").style({width:function(a){return f(a.weight)+"px"},height:"20px","background-color":function(a){return h.colorMapping.get(a.dataID)}}),g.append("td").attr("class","datalabel").text(function(a){return a.d}),d()},a.prototype.reweightStackedColumnDialog=function(a){var b=this,c=e(this.$container,'re-weight column "'+a.label+'"',d),f=a.children.map(function(b,c){return{d:b.column.label,dataID:b.getDataID(),weight:+a.childrenWeights[c],index:c}});this.reweightStackedColumnWidget(f,c.table),c.onOK(function(){c.remove(),b.changeWeights(a,f.map(function(a){return a.weight}))})},a.prototype.openMappingEditor=function(b,c){function e(a){j=a,b.mapping(j);var e=o.node().checked;e?b.filter=a.domain():b.filter=d,c.classed("filtered",!f(j.range(),h.range())||!f(j.domain(),h.domain())),i.listeners["change-filter"](i,b),i.config.filtering&&i.config.filtering.external||i.storage.resortData({filteredChanged:!0}),i.updateAll(!0)}function f(a,b){if(a&&b){var c=a[0]===b[0],d=a[1]===b[1];return!c&&isNaN(a[0])&&isNaN(b[0])&&(c=!0),!d&&isNaN(a[1])&&isNaN(b[1])&&(d=!0),c&&d}return a===b}var g=b.mapping(),h=b.originalMapping(),i=this,j=g,k=this.$container.node().clientHeight,l=Math.max(270,Math.min(k/2,470)),m=this.$container.append("div").attr("class","lu-popupBG"),n=this.$container.append("div").attr({"class":"lu-popup"}).style({left:+this.$container.node().clientWidth/2-100+"px",top:"0px",width:l-50+"px"}).html('<div style="font-weight: bold"> change mapping: </div><div class="mappingArea"></div><label><input type="checkbox" id="filterIt" value="filterIt">Filter Outliers</label><br><button class="cancel"><i class="fa fa-times"></i> cancel</button><button class="reset"><i class="fa fa-undo"></i> revert</button><button class="ok"><i class="fa fa-check"></i> ok</button>'),o=n.select("input").on("change",function(){e(j)});o.node().checked=Array.isArray(b.filter);var p=function(a){return+b.getValue(a,"raw")},q={callback:e,triggerCallback:"dragend",width:l-50,height:l-50},r=h.domain();isNaN(r[0])&&(r[0]=0),isNaN(r[1])&&(r[1]=0);var s=a.mappingEditor(g,r,i.storage.rawdata,p,q,this);n.select(".mappingArea").call(s),n.select(".ok").on("click",function(){e(j),n.remove(),m.remove()}),n.select(".cancel").on("click",function(){b.mapping(g),c.classed("filtered",!f(g.range(),h.range())||!f(g.domain(),h.domain())),n.remove(),m.remove()}),n.select(".reset").on("click",function(){j=g=h,e(h),s=a.mappingEditor(g,h.domain(),i.storage.rawdata,p,q,i),n.selectAll(".mappingArea *").remove(),n.select(".mappingArea").call(s)})},a.prototype.stackedColumnOptionsGui=function(a){function d(a){h.storage.removeColumn(a),h.listeners["columns-changed"](h),h.headerUpdateRequired=!0,h.updateAll()}function e(a){function b(a){return c(h.$container.node()).find("#"+a)[0]}var d=+this.$container.node().clientWidth/2-100,e=0,f=this.$container.append("div").attr("class","lu-popupBG"),g=this.$container.append("div").attr({"class":"lu-popup"}).style({left:d+"px",top:e+"px",width:"200px",height:"70px"}).html('<div style="font-weight: bold"> rename column: </div><input type="text" id="popupInputText" size="20" value="'+a.label+'"><br><button class="cancel"><i class="fa fa-times"></i> cancel</button><button class="ok"><i class="fa fa-check"></i> ok</button>');g.select(".ok").on("click",function(){var c=b("popupInputText").value;c.length>0?(a.label=c,h.updateHeader(h.storage.getColumnLayout(a.columnBundle)),h.listeners["columns-changed"](h),g.remove(),f.remove()):window.alert("non empty string required")}),g.select(".cancel").on("click",function(){g.remove(),f.remove()})}var f=this.config,g=this.$header.select(".overlay"),h=this,i=this.stackedColumnModified===a;if(i)return g.selectAll(".stackedOption").remove(),void(this.stackedColumnModified=null);this.stackedColumnModified=a;var j=[{name:" remove",action:d},{name:" rename",action:e},{name:" re-weight",action:h.reweightStackedColumnDialog}],k=100*j.length,l=g.selectAll(".stackedOption").data([{d:a,o:j}]);l.exit().remove();var m=l.enter().append("div").attr({"class":"stackedOption"}).style({position:"absolute",left:function(a){return a.d.offsetX+a.d.columnWidth-k+"px"},top:"calc("+(f.htmlLayout.headerHeight/2-2)+"px - .5em)","background-color":"white",width:k+"px",height:f.htmlLayout.headerHeight/2-4+"px"});m.selectAll(".stackedOption-action").data(function(a){return a.o}).enter().append("div").attr({"class":"stackedOption-action"}).style({position:"absolute",left:function(a,b){return 100*b+5+"px"},top:"calc("+(f.htmlLayout.headerHeight/4-2)+"px - .5em)"}).text(function(a){return a.name}),l.selectAll(".stackedOption-action").on("click",function(c){g.selectAll(".stackedOption").remove(),c.action.call(h,a),b.event.preventDefault(),b.event.stopPropagation()}),l.transition().style({position:"absolute",left:function(a){return a.d.offsetX+a.d.columnWidth-k+"px"},top:"calc("+(f.htmlLayout.headerHeight/2-2)+"px - .5em)"})},a.prototype.openCategoricalFilterPopup=function(b,c){function d(){var a=h.select("tbody").selectAll("tr").data(j);a.select(".checkmark").html(function(a){return'<i class="fa fa-'+(a.isChecked?"check-":"")+'square-o"></i>'}).on("click",function(a){a.isChecked=!a.isChecked,d()}),a.select(".datalabel").style("opacity",function(a){return a.isChecked?"1.0":".8"})}function e(a){var d=b.filter||!1;a=a||!1,d!==a&&(b.filter=a,c.classed("filtered",a&&a.length>0&&a.length<b.column.categories.length),i.listeners["change-filter"](i,b),i.config.filtering&&i.config.filtering.external||i.storage.resortData({filteredChanged:!0}),i.updateBody())}if(b instanceof a.LayoutCategoricalColumn){var f=b.filter||[],g=this.$container.append("div").attr("class","lu-popupBG"),h=this.$container.append("div").attr({"class":"lu-popup"}).style({left:+this.$container.node().clientWidth/2-100,top:"0px",width:"400px"}).html('<span style="font-weight: bold">Edit Filter</span><form onsubmit="return false"><div class="selectionTable"><table><thead><th></th><th>Category</th></thead><tbody></tbody></table></div><button class="ok"><i class="fa fa-check" title="ok"></i></button><button class="cancel"><i class="fa fa-times" title="cancel"></i></button><button class="reset"><i class="fa fa-undo" title="reset"></i></button></form>');h.select(".selectionTable").style({width:"390px",height:"260px"});var i=this,j=b.column.categories.map(function(a){return{d:a,isChecked:0===f.length||f.indexOf(a)>=0}}),k=h.select("tbody").selectAll("tr").data(j);k.enter().append("tr"),k.append("td").attr("class","checkmark"),k.append("td").attr("class","datalabel").text(function(a){return a.d}),d(),h.select(".cancel").on("click",function(){e(f),h.remove(),g.remove()}),h.select(".reset").on("click",function(){j.forEach(function(a){a.isChecked=!0}),d(),e(null)}),h.select(".ok").on("click",function(){var a=j.filter(function(a){return a.isChecked}).map(function(a){return a.d});a.length===b.column.categories.length&&(a=[]),e(a),h.remove(),g.remove()})}},a.prototype.openFilterPopup=function(b,d){function e(a){var c=b.filter||!1;a=a||!1,c!==a&&(b.filter=a,d.classed("filtered",a&&a.length>0),k.listeners["change-filter"](k,b),k.config.filtering&&k.config.filtering.external||k.storage.resortData({filteredChanged:!0}),k.updateBody())}function f(a){return c(k.$container.node()).find("#"+a)[0]}if(b instanceof a.LayoutStringColumn){var g={left:b.offsetX,top:0},h=b.filter||"",i=this.$container.append("div").attr("class","lu-popupBG"),j=this.$container.append("div").attr({"class":"lu-popup2"}).style({left:g.left+"px",top:g.top+"px"}).html('<form onsubmit="return false"><input type="text" id="popupInputText" placeholder="containing..." autofocus="true" size="18" value="'+h+'"><br><button class="ok"><i class="fa fa-check" title="ok"></i></button><button class="cancel"><i class="fa fa-times" title="cancel"></i></button><button class="reset"><i class="fa fa-undo" title="reset"></i></button></form>'),k=this;j.select(".cancel").on("click",function(){f("popupInputText").value=h,e(h),j.remove(),i.remove()}),j.select(".reset").on("click",function(){f("popupInputText").value="",e(null)}),j.select(".ok").on("click",function(){e(f("popupInputText").value),j.remove(),i.remove()})}},a.createTooltip=function(a){function b(a,b){i.html(a).css({left:b.x+"px",top:b.y+b.height-h.offset().top+"px"}).fadeIn();var d=c(window).height()+c(window).scrollTop()<=b.y+b.height+i.height()-20,e=c(window).scrollTop()>b.y-i.height();
d&&!e&&i.css("top",b.y-i.height()-h.offset().top+"px")}function d(){i.stop(!0).hide()}function e(a){a.x&&i.css({left:a.x+"px"}),a.y&&i.css({top:a.y-h.offset().top+"px"})}function f(){return[i.width(),i.height()]}function g(){i.remove()}var h=c(a),i=c('<div class="lu-tooltip"/>').appendTo(h);return{show:b,hide:d,move:e,size:f,destroy:g}},a.prototype.initScrolling=function(a,b){function d(){var a=h.scrollTop,b=h.scrollLeft;g.scrolled(a,b),Math.abs(j-a)>=i*(l/2)&&(j=a,g.updateBody())}function e(b,c){var d,e=h.scrollTop-f,g=e+a.innerHeight(),j=0;if(e>0){for(j=Math.round(e/i);j>=0&&c(b[j+1])>e;)j--;j-=l}for(d=Math.round(g/i);d<=b.length&&c(b[d-1])<g;)d++;return d+=l,[Math.max(j,0),Math.min(d,b.length)]}var f,g=this,h=a[0],i=this.config.svgLayout.rowHeight+this.config.svgLayout.rowPadding,j=h.scrollTop,k=c(this.$table.node()),l=this.config.svgLayout.backupScrollRows;return a.on("scroll",d),f=k.offset().top-a.offset().top+b,{selectVisible:e,onScroll:d}},a.prototype.initDragging=function(){function c(){b.event.sourceEvent.stopPropagation(),b.select(this).classed("dragging",!0)}function d(){var a=Math.max(b.mouse(this.parentNode)[0],f.config.htmlLayout.handleWidth/2);f.reweightHeader({column:b.select(this).data()[0],value:a}),f.updateBody(f.storage.getColumnLayout(),f.storage.getData(),!1)}function e(){b.select(this).classed("dragging",!1),f.config.columnBundles.primary.sortedColumn instanceof a.LayoutStackedColumn&&(f.listeners["change-sortcriteria"](f,f.config.columnBundles.primary.sortedColumn),f.config.sorting&&f.config.sorting.external||f.storage.resortData({column:f.config.columnBundles.primary.sortedColumn}),f.updateBody(f.storage.getColumnLayout(),f.storage.getData(),!1))}var f=this;return b.behavior.drag().origin(function(a){return a}).on("dragstart",c).on("drag",d).on("dragend",e)}}(d||(d={}),b,a);var d;!function(a,b,c){"use strict";function d(a,b,c,d,e,f){return a.append("line").attr({x1:b,y1:c,x2:d,y2:e,"class":f})}function e(a,b,c,d,e,f,g,h,i){return e=e||null,f=f||null,a.append("text").attr({x:b,y:c,dy:e,"class":f,"clip-path":"url("+g+"#clip-H"+h+")","text-anchor":i}).text(d)}function f(a,b,c,d,e){return c-=b,a.append("circle").attr({"class":"handle",r:e,cx:b,cy:d,transform:"translate("+c+",0)"})}function g(a){return"undefined"!=typeof a&&null!==a?(a+"").length<=5?a:a.toExponential?a.toExponential(1):a.substring?a.substring(0,3)+"...":a:""}a.mappingEditor=function(a,h,i,j,k,l){var m=l.getClipSource.apply(l.$container[0][0]);k=c.extend({width:400,height:400,padding:50,radius:10,callback:c.noop,callbackThisArg:null,triggerCallback:"change"},k);var n=function(c){function l(a,c){return b.behavior.drag().on("dragstart",function(){b.select(this).classed("dragging",!0).attr("r",1.1*k.radius),a.style("visibility","visible")}).on("drag",c).on("dragend",function(){b.select(this).classed("dragging",!1).attr("r",k.radius),a.style("visibility",null),p(!0)}).origin(function(){var a=b.transform(b.select(this).attr("transform"));return{x:a.translate[0],y:a.translate[1]}})}function n(){a.range([x,y]),F.attr("x1",function(b){return a(j(b))}),p()}function o(){var b,c;B>A?(b=F.filter(function(a){return v(j(a))<A||v(j(a))>B}),c=F.filter(function(a){return!(v(j(a))<A||v(j(a))>B)})):(b=F.filter(function(a){return v(j(a))>A||v(j(a))<B}),c=F.filter(function(a){return!(v(j(a))>A||v(j(a))<B)})),b.style("visibility","hidden"),a.domain([v.invert(A),v.invert(B)]),c.style("visibility",null).attr("x1",function(b){return a(j(b))}),p()}function p(a){if(a===("dragend"===k.triggerCallback)){var c=b.scale.linear().domain([v.invert(A),v.invert(B)]).range([w.invert(x),w.invert(y)]);k.callback.call(k.callbackThisArg,c)}}var q=c.append("svg").attr({"class":"lugui-me",width:k.width,height:k.height}),r=k.padding,s=k.width-k.padding,t=k.padding,u=k.height-k.padding,v=b.scale.linear().domain(h).range([r,s]),w=b.scale.linear().domain([0,1]).range([r,s]),x=w(a.range()[0]),y=w(a.range()[1]),z=a.domain();isNaN(z[0])&&(z[0]=0),isNaN(z[1])&&(z[1]=0);var A=v(z[0]),B=v(z[1]);a=b.scale.linear().clamp(!0).domain(z).range([x,y]);var C=[{name:"score_min",x:r,y:t-25,width:40,height:20},{name:"score_max",x:s-40,y:t-25,width:40,height:20},{name:"value_min",x:r,y:u+20,width:45,height:20},{name:"value_max",x:s-45,y:u+20,width:45,height:20}];q.append("defs");var D=q.select("defs").selectAll(function(){return this.getElementsByTagName("clipPath")}).data(C,function(a){return a.name});D.enter().append("clipPath").attr("id",function(a){return"clip-H"+a.name}).append("rect"),D.exit().remove(),D.select("rect").attr({x:function(a){return a.x},y:function(a){return a.y},width:function(a){return a.width},height:function(a){return a.height}});var E=q.append("g");d(E,r,t,s,t,"axis"),e(E,r,t-25,0,".75em",void 0,m,"score_min","start"),e(E,s,t-25,1,".75em",void 0,m,"score_max","end"),e(E,k.width/2,t-25,"Score",".75em","centered",m,"score","middle"),d(E,r,u,s,u,"axis"),e(E,r,u+20,g(h[0]),".75em",void 0,m,"value_min","start"),e(E,s,u+20,g(h[1]),".75em",void 0,m,"value_max","end"),e(E,k.width/2,u+20,"Raw",".75em","centered",m,"value","middle");var F=q.append("g").classed("data",!0).selectAll("line").data(i);F.enter().append("line").attr({x1:function(b){return a(j(b))},y1:t,x2:function(a){return v(j(a))},y2:u}).style("visibility",function(a){var b;return b=B>A?v(j(a))<A||v(j(a))>B:v(j(a))>A||v(j(a))<B,b?"hidden":null});var G=d(q,x,t,A,u,"bound"),H=d(q,y,t,B,u,"bound"),I=e(q,r+5,t-15,b.round(w.invert(x),2),".25em","drag").attr("transform","translate("+(x-r)+",0)"),J=e(q,r+5,u-15,b.round(v.invert(A),2),".25em","drag").attr("transform","translate("+(A-r)+",0)"),K=e(q,s+5,t-15,b.round(w.invert(y),2),".25em","drag").attr("transform","translate("+(y-s)+",0)"),L=e(q,s+5,u-15,b.round(v.invert(B),2),".25em","drag").attr("transform","translate("+(B-s)+",0)");f(q,r,x,t,k.radius).call(l(I,function(){b.event.x>=0&&b.event.x<=s-r&&(G.attr("x1",r+b.event.x),b.select(this).attr("transform","translate("+b.event.x+", 0)"),x=b.event.x+r,I.text(b.round(w.invert(x),2)).attr("transform","translate("+b.event.x+", 0)"),n())})),f(q,s,y,t,k.radius).call(l(K,function(){b.event.x>=-1*(s-r)&&b.event.x<=0&&(H.attr("x1",s+b.event.x),b.select(this).attr("transform","translate("+b.event.x+", 0)"),y=b.event.x+s,K.text(b.round(w.invert(y),2)).attr("transform","translate("+b.event.x+", 0)"),n())})),f(q,r,A,u,k.radius).call(l(J,function(){b.event.x>=0&&b.event.x<=s-r&&(G.attr("x2",r+b.event.x),b.select(this).attr("transform","translate("+b.event.x+", 0)"),A=b.event.x+r,J.text(b.round(v.invert(A),2)).attr("transform","translate("+b.event.x+", 0)"),o())})),f(q,s,B,u,k.radius).call(l(L,function(){b.event.x>=-1*(s-r)&&b.event.x<=0&&(H.attr("x2",s+b.event.x),b.select(this).attr("transform","translate("+b.event.x+", 0)"),B=b.event.x+s,L.text(b.round(v.invert(B),2)).attr("transform","translate("+b.event.x+", 0)"),o())}))};return n}}(d||(d={}),b,a);var d;!function(a,b,c,d,e){function f(b){return function c(d){d.columnBundle=b,d instanceof a.LayoutStackedColumn&&d.children.forEach(c)}}function g(d,e,f,h,i){function j(a){return new l[a.type](a,j,d)}function k(b){var c=b.type||"single";if("single"===c){var d=o.get(b.column);d instanceof a.LineUpNumberColumn?c="number":d instanceof a.LineUpCategoricalColumn&&(c="categorical")}return new m[c](b,o,k,n)}this.storageConfig=c.extend(!0,{},{colTypes:{number:a.LineUpNumberColumn,string:a.LineUpStringColumn,categorical:a.LineUpCategoricalColumn},layoutColumnTypes:{number:a.LayoutNumberColumn,single:a.LayoutStringColumn,string:a.LayoutStringColumn,categorical:a.LayoutCategoricalColumn,categoricalcolor:a.LayoutCategoricalColorColumn,stacked:a.LayoutStackedColumn,rank:a.LayoutRankColumn,actions:a.LayoutActionColumn}},i),this.config=null;var l=this.storageConfig.colTypes,m=this.storageConfig.layoutColumnTypes,n=this;this.storageConfig.toColumn=j,this.primaryKey=h,this.rawdata=d,this.selected=b.set(),this.rawcols=e.map(j),this.layout=f||g.generateDefaultLayout(this.rawcols);var o=b.map();this.rawcols.forEach(function(a){o.set(a.column,a)}),this.storageConfig.toLayoutColumn=k;var p=this.bundles={};Object.keys(this.layout).forEach(function(a){p[a]={layoutColumns:[],needsLayout:!0,data:d,initialSort:!0}})}a.LineUpLocalStorage=g,a.createLocalStorage=function(a,b,c,d,e){return new g(a,b,c,d,e)},g.generateDefaultLayout=function(b){var c=b.map(function(b){return{column:b.column,width:b instanceof a.LineUpStringColumn?200:100}});return{primary:c}},g.prototype=c.extend({},{},{getRawColumns:function(){return this.rawcols},getColumnLayout:function(a){var b=a||"primary";return this.bundles[b].needsLayout&&(this.generateLayout(this.layout,b),this.bundles[b].needsLayout=!1),this.bundles[b].layoutColumns},isSelected:function(a){return this.selected.has(a[this.primaryKey])},select:function(a){this.selected.add(a[this.primaryKey])},selectAll:function(a){var b=this;a.forEach(function(a){b.selected.add(a[b.primaryKey])})},setSelection:function(a){this.clearSelection(),this.selectAll(a)},deselect:function(a){this.selected.remove(a[this.primaryKey])},selectedRows:function(){return this.rawdata.filter(this.isSelected.bind(this))},clearSelection:function(){this.selected=b.set()},getData:function(a){return a=a||"primary",this.bundles[a].data},filterData:function(a){var b=[];return a.forEach(function(a){a.flattenMe(b)}),b=b.filter(function(a){return a.isFiltered()}),c.isFunction(this.config.filter.filter)&&b.push(this.config.filter.filter),0===b.length?this.rawdata:this.rawdata.filter(function(a){return b.every(function(b){return b.filterBy(a)})})},resortData:function(c){function d(a,c){var d=i.sortBy(a,c);return 0===d||isNaN(d)?b.ascending(a[m],c[m]):h?-d:d}var e=c.key||"primary",f=this,g=this.bundles[e],h=c.asc||this.config.columnBundles[e].sortingOrderAsc,i=c.column||this.config.columnBundles[e].sortedColumn,j=this.getColumnLayout(e);if(g.data=this.filterData(j),c.filteredChanged||g.initialSort){var k=[];j.forEach(function(a){a.flattenMe(k)});var l=f.config.histograms&&f.config.histograms.generator;k.forEach(function(a){a.prepare(g.data,f.config.renderingOptions.histograms,l)}),g.initialSort=!1}var m=this.primaryKey;i&&g.data.sort(d);var n=this.config.filter.skip?this.config.filter.skip:0;this.config.filter.limit&&isFinite(this.config.filter.limit)?g.data=g.data.slice(n,n+this.config.filter.limit):g.data=g.data.slice(n);var o=g.layoutColumns.filter(function(b){return b instanceof a.LayoutRankColumn});if(o.length>0){var p=function(a,b){return b};i&&(p=function(a){return i.getValue(a)}),this.assignRanks(g.data,p,o)}},assignRanks:function(a,b,c){var d=1,e=-1;a.forEach(function(a,f){-1===e&&(e=b(a,f)),e!==b(a,f)&&(d=f+1,e=b(a,f)),c.forEach(function(b){b.setValue(a,d)})})},generateLayout:function(b,c){var d=c||"primary",e=this.bundles[d];e.layoutColumns=b[d].map(this.storageConfig.toLayoutColumn),e.layoutColumns.filter(function(b){return b instanceof a.LayoutRankColumn}).length<1&&e.layoutColumns.unshift(new a.LayoutRankColumn(null,null,null,this)),this.config.svgLayout.rowActions.length>0&&e.layoutColumns.filter(function(b){return b instanceof a.LayoutActionColumn}).length<1&&e.layoutColumns.push(new a.LayoutActionColumn),e.layoutColumns.forEach(f(d))},addColumn:function(b,c,d){var e,f,g=c||"primary",h=this.bundles[g].layoutColumns;if("undefined"==typeof d||null===d)for(e=0;e<h.length&&(f=h[e],f instanceof a.LayoutRankColumn||f instanceof a.LayoutStringColumn);++e);else 0>d&&(d=h.length+1+d),e=Math.max(0,Math.min(h.length,d));b.columnBundle=g,h.splice(e,0,b)},addStackedColumn:function(a,b,d){var e=c.extend({type:"stacked",label:"Stacked",children:[]},a);this.addColumn(this.storageConfig.toLayoutColumn(e),d,b)},addSingleColumn:function(a,b,c){this.addColumn(this.storageConfig.toLayoutColumn(a),c,b)},removeColumn:function(b){var c=this.bundles[b.columnBundle].layoutColumns;if(b instanceof a.LayoutStackedColumn){var f=d.indexOf(c,b);if(f!==e){var g=[];Array.prototype.splice.apply(c,[f,1].concat(g))}}else b.column&&(null===b.parent||b.parent===e?c.splice(c.indexOf(b),1):(b.parent.removeChild(b),this.resortData({})))},moveColumn:function(a,b,c){var d,e=this.bundles[a.columnBundle].layoutColumns,g=this.bundles[b.columnBundle].layoutColumns;null==a.parent&&null==b.parent?(e.splice(e.indexOf(a),1),d=g.indexOf(b),"r"===c&&d++,g.splice(d,0,a)):null!==a.parent&&null===b.parent?(a.parent.removeChild(a),d=g.indexOf(b),"r"===c&&d++,g.splice(d,0,a)):null===a.parent&&null!==b.parent?b.parent.addChild(a,b,c)&&e.splice(e.indexOf(a),1):null!==a.parent&&null!==b.parent&&(a.parent.removeChild(a),b.parent.addChild(a,b,c)),f(b.columnBundle)(a),this.resortData({})},copyColumn:function(a,b,c){var d=this.bundles[b.columnBundle].layoutColumns,e=a.makeCopy();if(f(b.columnBundle)(e),null==b.parent){var g=d.indexOf(b);"r"===c&&g++,d.splice(g,0,e)}else null!==b.parent&&b.parent.addChild(e,b,c);this.resortData({})},getColumnByName:function(a,b){for(var c=this.getColumnLayout().slice(0),d=[],e=c.length-1;e>=0;--e){var f=c[e];if(f.getLabel()===a||f.column&&f.column.column===a){if(!b)return f;d.push(f)}else if(f.children)for(var g=0;g<f.children.length;g++)c.unshift(f.children[g]),e++}return b?d:null}})}(d||(d={}),b,a,c);var d;!function(a,b,c,d){function e(b,c,d){function e(a){return["left:"+a.offsetX+"px","width:"+a.width+"px","line-height:"+d.svgLayout.rowHeight+"px"].join(";")}var f=b.filter(function(b){return b instanceof a.LayoutCategoricalColumn||b instanceof a.LayoutStringColumn||b instanceof a.LayoutRankColumn}),g=d.svgLayout.columnPadding,h=c.selectAll(".tableData.text").data(function(b){var c=f.map(function(c){return{value:c.getValue(b),label:c.getValue(b,"raw"),offsetX:c.offsetX+g/2,width:Math.max(c.getColumnWidth()-g,0),isRank:c instanceof a.LayoutRankColumn,column:c,row:b}}).filter(function(a){return!!d.cellFormatter||!!a.label});return c}),i=h.enter().append("div").attr({"class":function(a){return"tableData text"+(a.isRank?" rank":"")},style:e});h.exit().remove(),h.attr("style",e).text(function(a){return a.label}),d.cellFormatter&&(i.call(d.cellFormatter),h.call(d.cellFormatter)),c.selectAll(".tableData.text.rank").text(function(a){return a.label})}function f(b,c,d,e){var f=b.filter(function(b){return b instanceof a.LayoutCategoricalColorColumn}),g=e.svgLayout.rowHeight-2*e.svgLayout.rowBarPadding,h=c.selectAll(".tableData.cat").data(function(a){var b=f.map(function(b){return{value:b.getValue(a),label:b.getValue(a,"raw"),offsetX:b.offsetX,columnW:b.getColumnWidth(),color:b.getColor(a),clip:"url(#clip-B"+b.id+")"}});return b});h.enter().append("rect").attr({"class":"tableData cat",y:e.svgLayout.rowBarPadding,height:e.svgLayout.rowHeight-2*e.svgLayout.rowBarPadding,width:g}).append("title"),h.exit().remove(),h.attr("x",function(a){return a.offsetX+2}).style("fill",function(a){return a.color}).select("title").text(function(a){return a.label})}function g(b,c){if(!b.renderingOptions.stacked||b.renderingOptions.values)return!1;var d=b.columnBundles.primary.sortedColumn;if(d&&d&&d.column&&d.column.column)for(var e=c.storage.getColumnByName(d.column.column,!0),f=0;f<e.length;f++)if(e[f].parent instanceof a.LayoutStackedColumn)return!1;return!(d&&d.parent instanceof a.LayoutStackedColumn)}function h(c,d,e){var f=c.filter(function(b){return b.column instanceof a.LineUpNumberColumn}),g=d.selectAll(".tableData.bar").data(function(a){var b=f.map(function(b){return{key:b.getDataID(),value:b.getWidth(a),label:b.column.getRawValue(a),offsetX:b.offsetX}});return b}),h=e.svgLayout.columnPadding,i=e.svgLayout.rowHeight-2*e.svgLayout.rowBarPadding,j={position:"absolute",left:function(a){return a.offsetX+h/2+"px"},width:function(a){return Math.max(+a.value-h,0)+"px"},height:i+"px","margin-top":e.svgLayout.rowBarPadding+"px","background-color":function(a){return b.rgb(e.colorMapping.get(a.key))}};g.enter().append("div").attr({"class":"tableData bar"}).style(j),g.exit().remove(),g.style(j)}function i(c,d,e,f,h){var i=c.filter(function(b){return b instanceof a.LayoutStackedColumn}),j=d.selectAll(".tableData.stacked").data(function(a){var b=i.map(function(b){return{key:b.getDataID(),childs:b.children,parent:b,row:a}});return b});j.exit().remove(),j.enter().append("div").attr("class","tableData stacked"),j.attr("style",function(a){return"position:absolute;left:"+a.parent.offsetX+"px"});var k=0,l=0,m={},n=g(f,h),o=j.selectAll("div").data(function(a){return k=0,l=0,a.childs.map(function(b,c){return l=b.getWidth(a.row),m={child:b,width:l,offsetX:k,last:c===a.childs.length-1},k+=n?l:b.getColumnWidth(),m})}),p=f.svgLayout.columnPadding,q=f.svgLayout.rowHeight-2*f.svgLayout.rowBarPadding,r={position:"absolute",height:q+"px",left:function(a){var b=0;return n||(b+=p/2),a.offsetX+b+"px"},width:function(a){var b=!n||a.last?-p:1;return Math.max(a.width>0?a.width+b:a.width,0)+"px"},"background-color":function(a){return b.rgb(f.colorMapping.get(a.child.getDataID()))}};o.exit().remove(),o.enter().append("div").style(r),(e?o.transition(f.svgLayout.animationDuration):o).style(r)}function j(a,b,c){var d=a.selectAll("text").data(c.svgLayout.rowActions);d.enter().append("text").append("title"),d.exit().remove(),d.attr("x",function(a,b){return b*c.svgLayout.rowHeight}).text(function(a){return a.icon}).on("click",function(a){a.action.call(this,b.data,a)}).select("title").text(function(a){return a.name})}function k(c,d,e){var f=c.filter(function(b){return b instanceof a.LayoutActionColumn}),g=d.selectAll(".tableData.action").data(function(a){var b=f.map(function(b){return{key:b.getDataID(),value:b.getColumnWidth(a),data:a,offsetX:b.offsetX}});return b});g.enter().append("g").attr("class","tableData action").each(function(a){j(b.select(this),a,e)}),g.exit().remove(),g.attr("transform",function(a){return"translate("+(a.offsetX+10)+","+(.5*e.svgLayout.rowHeight+1)+")"})}function l(b,c){var d=b.getValue(c,"raw");return(b instanceof a.LayoutNumberColumn||b instanceof a.LayoutStackedColumn)&&(d=null===d||"undefined"==typeof d?0:isNaN(d)||""===d.toString()?"":+d),d}function m(a,b,d){var e=c("<div><table><thead><tr><th>Column</th><th>Value</th></tr></thead><tbody></tbody></table></div>"),f=e.find("tbody");return b.forEach(function(b){var e=l(b,a);"undefined"==typeof e?e="":"number"==typeof e&&(e=d.numberformat(e)),c("<tr><th>"+b.getLabel()+"</th><td>"+e+"</td></tr>").appendTo(f)}),e.html()}a.prototype=a.prototype||{},a.prototype.select=function(a){var b=this.storage.primaryKey,c=this.$body.selectAll(".row");Array.isArray(a)?(this.storage.setSelection(a),a=a.map(function(a){return a[b]}),c.classed("selected",function(c){return a.indexOf(c[b])>=0})):a?(this.storage.setSelection([a]),c.classed("selected",function(c){return c[b]===a[b]})):(this.storage.clearSelection(),c.classed("selected",!1))},a.prototype.updateBody=function(d,j,l){function n(){return["height:"+r.config.svgLayout.rowHeight+"px","margin-top:"+r.config.svgLayout.rowPadding+"px"].join(";")+";"}function o(b){function c(a,c){return isNaN(a)||""===a||"undefined"==typeof a?"":r.config.numberformat(+a,b,c)}var e=[];return d.forEach(function(d){if(d.column instanceof a.LineUpNumberColumn)e.push({id:d.id,value:d.getValue(b),label:r.config.numberformat(+d.getValue(b,"raw"),b,d),x:d.offsetX+5,w:d.getColumnWidth()});else if(d instanceof a.LayoutStackedColumn){var f=0;d.children.forEach(function(a){var g=a.getWidth(b);e.push({id:a.id,label:c(a.getValue(b,"raw"),b,d)+" -> ("+t(a.getWidth(b))+")",w:D?g:a.getColumnWidth(),x:f+d.offsetX}),f+=D?g:a.getColumnWidth()})}}),e}function p(a,b,c){function d(a){return["left:"+a.x+"px","width:"+Math.max(+a.w-7,0)+"px"].join(";")}var e=a.selectAll("div."+c),f=e.data(b);f.enter().append("div").attr({"class":"tableData "+c,style:d}).text(function(a){return a.label}),f.exit().remove(),e.attr("style",d).text(function(a){return a.label})}if(!Array.isArray(d)||0!==d.length){d=d||this.storage.getColumnLayout(),j=j||this.storage.getData(d[0].columnBundle),l=l||!1;var q=this.$body,r=this,s=this.storage.primaryKey,t=b.format(".1f"),u=this.config.columnBundles[d[0].columnBundle];l=l||!1;var v=[];d.forEach(function(a){a.flattenMe(v)});var w=j.length,x=j,y=b.scale.ordinal().domain(j.map(function(a){var b=a[s];return null===b||"undefined"==typeof b?"":b})).rangeBands([0,w*(r.config.svgLayout.rowHeight+2)],0,0),z=u.prevRowScale||y;u.prevRowScale=y;var A=0;"combined"===r.config.svgLayout.mode&&(A=r.config.htmlLayout.headerHeight),this.$spacer.attr("style","position:absolute;top:0px;height:"+(w*r.config.svgLayout.rowHeight+A)+"px").html("&nbsp;");var B=this.selectVisible(j,y);(B[0]>0||B[1]<j.length)&&(j=j.slice(B[0],B[1]));var C=q.selectAll(".row").data(j,function(a){return a[s]});C.exit().remove(),C.enter().append("div").attr({style:function(a){var b=z(a[s]);if("undefined"==typeof b){var c=y.range();b=c&&c.length>0?c[c.length-1]:0}return n(a)+"transform:translate(0px, "+Math.ceil(b)+"px)"},"class":"row"}),(this.config.renderingOptions.animation?C.transition().duration(this.config.svgLayout.animationDuration):C).attr({style:function(a){var b=a[s],c=null===b||"undefined"==typeof b?0:y(b);return n(a)+"transform:translate(0px, "+Math.ceil(c)+"px)"}});var D=g(this.config,this);C.on({mouseenter:function(a){function d(a){return c(a).offset().top}var e=b.select(this);e.classed("hover",!0);var f=o(a),g=y(a[s]);p(e,f,"hoveronly"),r.config.interaction.tooltips&&r.tooltip.show(m(a,v,r.config),{x:b.mouse(r.$container.node())[0]+10,y:d(this),height:r.config.svgLayout.rowHeight}),r.hoverHistogramBin(a),r.listeners.hover(a,g)},mousemove:function(){r.config.interaction.tooltips&&r.tooltip.move({x:b.mouse(r.$container.node())[0]})},mouseleave:function(){r.config.interaction.tooltips&&r.tooltip.hide(),r.hoverHistogramBin(null),r.listeners.hover(null),b.select(this).classed("hover",!1),b.select(this).selectAll(".hoveronly").remove()},click:function(a){var c=b.select(this),d=r.storage.isSelected(a);if(r.config.interaction.multiselect(b.event)){var e=r.storage.selectedRows();if(d)c.classed("selected",!1),r.storage.deselect(a),1===e.length&&r.listeners.selected(null),e.splice(e.indexOf(a),1);else{if(c.classed("selected",!0),r.storage.select(a),r.config.interaction.rangeselect(b.event)&&1===e.length){var f=x.indexOf(a),g=x.indexOf(e[0]);e=g>f?x.slice(f,g+1):x.slice(g,f+1);var h=C.filter(function(a){return e.indexOf(a)>=0}).classed("selected",!0).data();r.storage.selectAll(h)}else e.push(a);1===e.length&&r.listeners.selected(a,null)}r.listeners.multiselected(e)}else if(d)c.classed("selected",!1),r.storage.deselect(a),r.listeners.selected(null),r.listeners.multiselected([]);else{var i=C.filter(".selected").classed("selected",!1);i=i.empty?null:i.datum(),c.classed("selected",!0),r.storage.setSelection([a]),r.listeners.selected(a,i),r.listeners.multiselected([a])}}});var E=C;h(d,E,r.config),i(d,E,this.config.renderingOptions.animation&&l,r.config,r),k(d,E,r.config),e(v,E,r.config),f(v,E,q,r.config),r.config.renderingOptions.values?(C.classed("values",!0),C.each(function(a){var c=b.select(this);p(c,o(a),"valueonly")})):C.classed("values",!1).selectAll(".valueonly").remove(),C.classed("selected",function(a){return r.storage.isSelected(a)})}}}(d||(d={}),b,a);var d;return function(a,b,c,d){a.prototype=a.prototype||{},a.prototype.layoutHeaders=function(c){var d=0,e=this.config,f=e.htmlLayout.headerHeight,g=e.htmlLayout.headerOffset;c.forEach(function(a){a.offsetX=d,a.offsetY=g,a.height=f-2*g,d+=a.getColumnWidth()});var h=d+4;b.values(e.svgLayout.plusSigns).forEach(function(a){a.x=h,h+=a.w+4}),c.filter(function(b){return b instanceof a.LayoutStackedColumn}).forEach(function(a){a.height=f/2-2*g;var b=0,c=a.offsetX,d=a.children.concat(a.emptyColumns);d.map(function(a){a.offsetX=c+b,a.localOffsetX=b,b+=a.getColumnWidth(),a.offsetY=f/2+g,a.height=f/2-2*g})}),this.totalWidth=h},a.prototype.updateHeader=function(d){function e(a,b){return a===b?!0:a&&b&&a.column&&b.column&&a.column.column===b.column.column}if(!Array.isArray(d)||0!==d.length){d=d||this.storage.getColumnLayout();var f=this.$header,g=f.select(".main"),h=this,i=this.config;this.headerUpdateRequired&&(this.layoutHeaders(d),this.$bodySVG.style({width:this.totalWidth+"px"}),this.headerUpdateRequired=!1);var j=[];d.forEach(function(a){a.flattenMe(j,{addEmptyColumns:!0})}),j.reverse();var k=g.selectAll(".header").data(j,function(a){return a.id});k.exit().remove();var l=k.enter().append("div").attr("class","header").classed("emptyHeader",function(b){return b instanceof a.LayoutEmptyColumn||b instanceof a.LayoutActionColumn}).classed("nestedHeader",function(b){return b&&b.parent instanceof a.LayoutStackedColumn}).call(function(){h.addResortDragging(this,i)}),m=i.htmlLayout.handleWidth;k.style({position:"absolute",left:function(a){return a.offsetX+"px"},top:function(a){return a.offsetY+"px"},width:function(b){return b instanceof a.LayoutEmptyColumn&&(b=b.parent),Math.max(b.getColumnWidth()-m/2,0)+"px"},height:function(a){return a.height+"px"}}).style("background-color",function(b){return b instanceof a.LayoutEmptyColumn?"lightgray":b.column&&i.colorMapping.has(b.column.id)?i.colorMapping.get(b.column.id):i.grayColor}).on("click",function(c){if(!(b.event.defaultPrevented||c instanceof a.LayoutEmptyColumn||c instanceof a.LayoutActionColumn||c instanceof a.LayoutRankColumn||c instanceof a.LayoutStackedColumn&&c.children.length<1)){var d=i.columnBundles[c.columnBundle];null!==d.sortedColumn&&e(d.sortedColumn,c)?d.sortingOrderAsc=!d.sortingOrderAsc:d.sortingOrderAsc=c instanceof a.LayoutStringColumn||c instanceof a.LayoutCategoricalColumn||c instanceof a.LayoutRankColumn,d.sortedColumn=c,h.listeners["change-sortcriteria"](this,c,d.sortingOrderAsc),h.config.sorting&&h.config.sorting.external||h.storage.resortData({column:c,asc:d.sortingOrderAsc}),h.updateAll(!1)}}),l.append("div").attr("class","hist");var n=k.filter(function(b){return b instanceof a.LayoutNumberColumn});if(this.config.renderingOptions.histograms?n.selectAll("div.hist").each(function(a){var c=b.select(this);a.getHist(function(b){if(b){var d=a.value2pixel.copy().range([0,a.value2pixel.range()[1]-5]),e=c.selectAll("div").data(b);e.enter().append("div").attr({"class":"hist-bar"}),e.style({position:"absolute",left:function(a){return d(a.x)+"px"},width:function(a){return Math.max(d(a.dx),0)+"px"},bottom:"0px",height:function(b){return Math.max(b.y,0)*a.height+"px"}})}})}):n.selectAll("div.hist").selectAll("*").remove(),this.config.manipulative&&(l.filter(function(b){return!(b instanceof a.LayoutEmptyColumn||b instanceof a.LayoutActionColumn)}).append("div").attr({"class":"weightHandle"}).style({position:"absolute","z-index":2,left:function(a){return Math.max(a.getColumnWidth()-m/2,0)+"px"},top:"0px",width:m+"px"}),k.select(".weightHandle").style({"box-sizing":"border-box",border:"1px solid #bbb","background-color":"lightgray",left:function(a){return Math.max(a.getColumnWidth()-m/2,0)+"px"},height:function(a){return a.height+"px"}}).call(this.dragWeight)),l.append("div").attr({"class":"headerLabel"}).style({overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-left":i.htmlLayout.labelLeftPadding+m/2+"px"}),k.select(".headerLabel").classed("sortedColumn",function(a){var b=i.columnBundles[a.columnBundle].sortedColumn;return e(b,a)}).style({"margin-top":function(b){return b instanceof a.LayoutStackedColumn||null!=b.parent?"calc("+.5*b.height+"px - .5em)":"calc("+.75*b.height+"px - .5em)"}}).text(function(a){return a.getLabel()}),l.append("div").attr({"class":"headerSort"}).style({position:"absolute",top:function(a){return"calc("+a.height/2+"px - .5em)"},left:m/2+"px"}),k.select(".headerSort").text(function(a){var b=i.columnBundles[a.columnBundle].sortedColumn;return e(b,a)?i.columnBundles[a.columnBundle].sortingOrderAsc?"":"":""}).style({top:function(a){return"calc("+a.height/2+"px - .5em)"}}),this.config.manipulative){var o=[{"class":"stackedColumnInfo",text:"",filter:function(b){return b instanceof a.LayoutStackedColumn?[b]:[]},action:function(a){h.stackedColumnOptionsGui(a)}},{"class":"singleColumnDelete",text:"",filter:function(b){return b instanceof a.LayoutRankColumn||b instanceof a.LayoutStackedColumn||b instanceof a.LayoutEmptyColumn||b instanceof a.LayoutActionColumn?[]:[b]},action:function(a){h.storage.removeColumn(a),h.listeners["columns-changed"](h),h.headerUpdateRequired=!0,h.updateAll()}},{"class":"singleColumnFilter",text:"",filter:function(a){return a.column?[a]:[]},offset:i.htmlLayout.buttonWidth,action:function(c){c instanceof a.LayoutStringColumn?h.openFilterPopup(c,b.select(this)):c instanceof a.LayoutCategoricalColumn?h.openCategoricalFilterPopup(c,b.select(this)):c instanceof a.LayoutNumberColumn&&h.openMappingEditor(c,b.select(this))}}];o.forEach(function(a){var c=k.selectAll("."+a["class"]).data(a.filter);c.exit().remove(),c.enter().append("div").attr("class",function(b){return"fontawe "+a["class"]+(b.isFiltered()?" filtered":"")}).text(a.text).on("click",function(){var c=Array.prototype.slice.call(arguments,0);a.action.apply(this,c),b.event.preventDefault(),b.event.stopPropagation()}),c.attr({"class":function(b){return"fontawe "+a["class"]+(b.isFiltered()?" filtered":"")}}).style({left:function(b){return b.getColumnWidth()-i.htmlLayout.buttonRightPadding-(a.offset||0)-m/2+"px"},position:"absolute",top:i.htmlLayout.buttonTopPadding+"px"})})}var p=b.values(i.svgLayout.plusSigns),q=g.selectAll(".addColumnButton").data(p);q.exit().remove();var r=q.enter().append("g").attr({"class":"addColumnButton"});q.attr({transform:function(a){return"translate("+a.x+","+a.y+")"}}),r.append("title").text(function(a){return a.title}),r.filter(function(a){return!a.render}).append("rect").attr({x:0,y:0,rx:5,ry:5,width:function(a){return a.w},height:function(a){return a.h}}).on("click",function(a){c.isFunction(a.action)?a.action.call(h,a):h[a.action](a)}),r.filter(function(a){return!a.render}).append("text").attr({x:function(a){return a.w/2},y:function(a){return a.h/2}}).text(function(a){return a.text||""}),r.filter(function(a){return!!a.render}).append(function(a){return a.render.call(h,a)}).on("click",function(a){c.isFunction(a.action)?a.action.call(h,a):h[a.action](a)})}},a.prototype.hoverHistogramBin=function(c){if(this.config.renderingOptions.histograms){var d=this.$header.selectAll("div.hist");d.selectAll(".hist-bar").classed("hover",!1),c&&this.$header.selectAll("div.hist").each(function(d){if(d instanceof a.LayoutNumberColumn){var e=this;d.getHist(function(a){a&&d.binOf(c,function(a){a>=0&&b.select(e).select(".hist-bar:nth-child("+(a+1)+")").classed("hover",!0)})})}})}},a.prototype.addResortDragging=function(c){function d(c){c instanceof a.LayoutEmptyColumn||(b.event.sourceEvent.stopPropagation(),b.select(this).classed("dragObject",!0),k=null,l=!1)}function e(c){function d(a,b,c){return b>a.offsetX&&b-a.offsetX<a.getColumnWidth()&&c>a.offsetY&&c-a.offsetY<a.height?b-a.offsetX<a.getColumnWidth()/2?{column:a,insert:"l",tickX:a.offsetX,tickY:a.offsetY,tickH:a.height}:{column:a,insert:"r",tickX:a.offsetX+a.getColumnWidth(),tickY:a.offsetY,tickH:a.height}:null}if(!(c instanceof a.LayoutEmptyColumn)){l=!0;var e=j.selectAll(".dragHeader").data([c]),f=e.enter().append("div").attr({"class":"dragHeader"}).style({"background-color":"black",position:"absolute",width:function(b){return b instanceof a.LayoutEmptyColumn&&(b=b.parent),b.getColumnWidth()+"px"},height:function(a){return a.height+"px"}});f.append("div");var g=b.mouse(i.node()),m=g[0]||0,n=g[1]||0;e.style({left:m+3+"px",top:n-10+"px"});var o=[];h.storage.getColumnLayout().forEach(function(a){a.flattenMe(o,{addEmptyColumns:!0})});var p=0;for(k=null;p<o.length&&null==k;)k=d(o[p],m,n),p++;var q=j.selectAll(".columnTick").data(k?[k]:[]);q.exit().remove(),q.enter().append("div").attr({"class":"columnTick"}).style({position:"absolute",width:"10px","background-color":"black"}),q.style({left:function(a){return a.tickX-5+"px"},top:function(a){return a.tickY+"px"},height:function(a){return a.tickH+"px"}})}}function f(c){b.event.defaultPrevented||c instanceof a.LayoutEmptyColumn||(b.select(this).classed("dragObject",!1),j.selectAll(".dragHeader").remove(),
j.selectAll(".columnTick").remove(),k&&k.column===this.__data__||(k&&(b.event.sourceEvent.altKey?h.storage.copyColumn(this.__data__,k.column,k.insert):h.storage.moveColumn(this.__data__,k.column,k.insert),h.listeners["columns-changed"](h),h.headerUpdateRequired=!0,h.updateAll()),null==k&&l&&(h.headerUpdateRequired=!0,h.storage.removeColumn(this.__data__),h.listeners["columns-changed"](h),h.updateAll())))}if(this.config.manipulative){var g=b.behavior.drag(),h=this,i=this.$header,j=i.select("div.overlay"),k=null,l=!1;g.call(c),g.on("dragstart",d).on("drag",e).on("dragend",f)}},a.prototype.addNewEmptyStackedColumn=function(){this.storage.addStackedColumn(null,-1),this.headerUpdateRequired=!0,this.listeners["columns-changed"](this),this.updateAll()},a.prototype.clearSelection=function(){this.select()},a.prototype.getClipSource=function(){return this.ownerDocument&&this.ownerDocument.documentURI!==this.ownerDocument.baseURI?this.ownerDocument.documentURI:""},a.prototype.reweightHeader=function(a){a.column.setColumnWidth(a.value),this.headerUpdateRequired=!0,this.updateAll()}}(d||(d={}),b,a),d}"function"==typeof define&&define.amd?define(["jquery","d3","underscore"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery"),require("d3"),require("underscore")):this.LineUp=a(jQuery,d3,_)}).call(this);